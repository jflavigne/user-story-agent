# Reflection String Detection Rule
# Finds hasattr/getattr/setattr calls with string literals
# These are contract strings that should be centralized
#
# Usage with ast-grep MCP:
#   mcp__ast-grep__find_code_by_rule:
#     project_folder: /path/to/project
#     yaml: <contents of this file>

id: reflection-strings
language: python
message: "Reflection with string literal '$ATTR' - consider extracting to constant"
severity: warning
rule:
  any:
    # hasattr(obj, "attr")
    - pattern: hasattr($OBJ, $ATTR)
      has:
        kind: string
        field: arguments
        stopBy: end
    # getattr(obj, "attr") or getattr(obj, "attr", default)
    - pattern: getattr($$$ARGS)
      has:
        kind: string
        field: arguments
        stopBy: end
    # setattr(obj, "attr", value)
    - pattern: setattr($OBJ, $ATTR, $VAL)
      has:
        kind: string
        field: arguments
        stopBy: end
    # delattr(obj, "attr")
    - pattern: delattr($OBJ, $ATTR)
      has:
        kind: string
        field: arguments
        stopBy: end
